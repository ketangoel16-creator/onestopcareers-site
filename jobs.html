---
title: Jobs & Referrals
layout: base
---

<main class="container mx-auto px-4 md:py-16">
    <h1 id="desktop-page-title" class="text-4xl md:text-5xl font-bold text-white mb-12 text-center">Find Your Next Opportunity</h1>

    <!-- Desktop Filters UI -->
    <section id="desktop-filters" class="bg-gray-900/70 backdrop-blur-sm p-4 sm:p-6 rounded-xl mb-8 sticky top-4 z-100 border border-gray-800 shadow-lg hidden md:block">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="text" id="desktop-search-input" placeholder="Search by job title or company..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-500">
            <select id="desktop-location-filter" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                <option value="">All Locations</option>
            </select>
            <select id="desktop-role-filter" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                <option value="">All Roles</option>
            </select>
            <button id="desktop-reset-filters" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2.5 px-4 rounded-lg">Clear Filters</button>
        </div>
    </section>
    
    <section id="jobs-section">
        <h2 class="text-2xl font-bold text-center text-white mb-6">Latest Job Opportunities</h2>
        <div id="loading-spinner" class="text-center py-12">
            <svg class="animate-spin h-10 w-10 text-orange-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
        </div>
        <div id="no-results" class="hidden text-center py-12">
            <h3 class="text-2xl font-semibold text-white">No Matching Jobs Found</h3>
        </div>
        <div id="job-listings-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-y-12 gap-x-6"></div>
        <div id="load-more-container" class="text-center mt-12 hidden">
            <button id="load-more-btn" class="text-white px-8 py-3 rounded-lg font-semibold text-sm hover:text-orange-400 transition-colors">Load More Jobs</button>
        </div>
    </section>

    <section id="referrals-section" class="mb-12">
        <h2 class="text-2xl font-bold text-center text-white mb-6">Referrals from our Network</h2>
        <div id="referrals-carousel-mobile" class="horizontal-carousel-wrapper space-x-4 pr-4 md:hidden"></div>
        <div id="referrals-grid-desktop" class="hidden md:grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <div id="referral-load-more-container" class="text-center mt-12 hidden">
            <button id="referral-load-more-btn" class="text-white px-8 py-3 rounded-lg font-semibold text-sm hover:text-orange-400 transition-colors">See More Referrals</button>
        </div>
    </section>
</main>

<!-- Mobile Filter Screen -->
<div id="mobile-filter-screen" class="fixed inset-0 bg-black z-40 p-4 transform translate-x-full">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-white">Filters</h2>
        <button id="close-filter-btn" class="p-2 text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
    </div>
    <div id="mobile-search-filter-options">
        <div class="mb-4">
            <label for="filter-location" class="block text-sm font-medium text-gray-400 mb-2">Location</label>
            <select id="filter-location" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                <option value="">All Locations</option>
            </select>
        </div>
        <h3 class="text-sm font-medium text-gray-400 mb-2">Roles</h3>
        <div id="mobile-role-filters" class="flex flex-col gap-2"></div>
    </div>
    <button id="apply-filters-btn" class="w-full mt-6 bg-orange-500 text-white font-semibold py-3 rounded-lg">Show Results</button>
    <button id="clear-filters-btn" class="w-full mt-2 bg-gray-700 text-white font-semibold py-3 rounded-lg">Clear All</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE MANAGEMENT ---
        const state = {
            allJobs: [],
            allReferrals: [],
            filteredJobs: [],
            filteredReferrals: [],
            currentPage: 1,
            currentReferralPage: 1,
            activePage: 'jobs',
            isMobile: window.matchMedia("(max-width: 767px)").matches,
            filters: {
                searchTerm: '',
                location: '',
                role: ''
            },
            ui: {
                isModalOpen: false,
                isFilterScreenOpen: false
            }
        };

        // --- CONFIGURATION & ELEMENTS ---
        const JOBS_JSON_URL = 'https://ketangoel16-creator.github.io/onestopcareers-data/jobs.json';
        const REFERRALS_JSON_URL = 'https://ketangoel16-creator.github.io/onestopcareers-data/referrals.json';
        const JOBS_PER_PAGE_DESKTOP = 10;
        const JOBS_PER_PAGE_MOBILE = 6;
        const REFERRALS_PER_PAGE_WEB = 9;

        const jobGrid = document.getElementById('job-listings-grid');
        const loadingSpinner = document.getElementById('loading-spinner');
        const noResultsMessage = document.getElementById('no-results');
        const loadMoreBtn = document.getElementById('load-more-btn');
        const modalOverlay = document.getElementById('job-modal-overlay');
        const referralsCarouselMobile = document.getElementById('referrals-carousel-mobile');
        const referralsGridDesktop = document.getElementById('referrals-grid-desktop');
        const referralLoadMoreBtn = document.getElementById('referral-load-more-btn');

        const desktopSearchInput = document.getElementById('desktop-search-input');
        const desktopLocationFilter = document.getElementById('desktop-location-filter');
        const desktopRoleFilter = document.getElementById('desktop-role-filter');
        const desktopResetFilters = document.getElementById('desktop-reset-filters');
        
        const mobileFilterToggle = document.getElementById('mobile-filter-toggle');
        const mobileFilterScreen = document.getElementById('mobile-filter-screen');
        const closeFilterBtn = document.getElementById('close-filter-btn');
        const applyFiltersBtn = document.getElementById('apply-filters-btn');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');

        const filterLocationSelect = document.getElementById('filter-location');
        const mobileRoleFiltersContainer = document.getElementById('mobile-role-filters');

        // --- HELPER FUNCTIONS ---
        const formatDateAgo = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            return `${days}d ago`;
        };

        const createDefaultLogo = (companyName) => {
            const firstLetter = (companyName || '?').charAt(0).toUpperCase();
            const logoDiv = document.createElement('div');
            logoDiv.className = "w-full h-full flex items-center justify-center bg-gray-800 text-gray-400 text-5xl font-bold";
            logoDiv.textContent = firstLetter;
            return logoDiv;
        };

        // --- MAIN RENDER FUNCTION ---
        function render() {
            renderJobs();
            renderReferrals();
        }

        function renderJobs() {
            if (!jobGrid) return; // Prevent error if element doesn't exist

            const jobsPerPage = state.isMobile ? JOBS_PER_PAGE_MOBILE : JOBS_PER_PAGE_DESKTOP;
            const jobsToDisplay = state.filteredJobs.slice(0, state.currentPage * jobsPerPage);
            jobGrid.innerHTML = '';
            if (noResultsMessage) noResultsMessage.style.display = jobsToDisplay.length > 0 ? 'none' : 'block';

            jobsToDisplay.forEach((job) => {
                const item = document.createElement('div');
                item.className = 'job-item group flex flex-col items-center text-center p-4 transition-transform duration-300 hover:-translate-y-1 border border-transparent hover:border-gray-800 rounded-2xl';
                item.dataset.jobId = job.ID;

                item.innerHTML = `
                    <div class="flex-grow w-full flex flex-col items-center">
                        <div class="relative w-32 h-32 mb-4">
                            <div class="w-full h-full rounded-full bg-gray-800 flex items-center justify-center overflow-hidden shadow-lg transition-transform duration-300 group-hover:scale-110">
                                <img data-company-name="${job.Company}" src="${job['Company Logo URL']}" alt="${job.Company} Logo" class="job-logo w-full h-full object-cover">
                            </div>
                        </div>
                        <h3 class="text-lg font-semibold text-white leading-tight">${job['Job Title']}</h3>
                        <p class="text-gray-400 text-sm">${job.Company}</p>
                        <p class="text-gray-500 text-xs mt-1">📍 ${job.Location}</p>
                    </div>
                    <div class="job-actions mt-4 w-full flex flex-col items-center gap-2">
                        <button class="apply-btn w-full bg-gradient-to-br from-orange-500 to-orange-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">Apply</button>
                    </div>
                `;
                jobGrid.appendChild(item);
            });

            document.querySelectorAll('.job-logo').forEach(img => {
                img.onerror = () => { img.replaceWith(createDefaultLogo(img.dataset.companyName)); };
            });

            if (loadMoreBtn) loadMoreBtn.parentElement.style.display = state.filteredJobs.length > (state.currentPage * jobsPerPage) ? 'block' : 'none';
        }

        function renderReferrals() {
            if (!referralsCarouselMobile && !referralsGridDesktop) return; // Prevent error if element doesn't exist

            const referralsToDisplay = state.isMobile ? state.allReferrals : state.allReferrals.slice(0, state.currentReferralPage * REFERRALS_PER_PAGE_WEB);
            const container = state.isMobile ? referralsCarouselMobile : referralsGridDesktop;

            container.innerHTML = '';

            if (state.isMobile) {
                referralsCarouselMobile.classList.remove('hidden');
                referralsGridDesktop.classList.add('hidden');
            } else {
                referralsGridDesktop.classList.remove('hidden');
                referralsCarouselMobile.classList.add('hidden');
            }

            referralsToDisplay.forEach((referral) => {
                const card = document.createElement('div');
                card.className = `referral-card p-6 rounded-2xl border border-gray-800 bg-gray-900/50 backdrop-blur-md transition-all duration-300 hover:border-orange-500/50 hover:scale-[1.02] ${state.isMobile ? 'flex-shrink-0 w-4/5' : ''}`;

                card.innerHTML = `
                    <div class="flex items-center gap-4 mb-4">
                        <a href="${referral['Link']}" target="_blank" class="flex-shrink-0">
                            <div class="w-16 h-16 rounded-full overflow-hidden flex items-center justify-center bg-gray-800 text-gray-400 text-2xl font-bold">
                                <span class="text-white">${referral.Name.charAt(0).toUpperCase()}</span>
                            </div>
                        </a>
                        <div>
                            <h3 class="text-xl font-bold text-white">${referral.Name}</h3>
                            <p class="text-sm text-gray-400">${referral.Designation}</p>
                            <p class="text-xs text-gray-500">${referral['Company name']}</p>
                        </div>
                    </div>
                    <a href="${referral['Link']}" target="_blank" class="w-full mt-4 inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-semibold rounded-lg bg-orange-500 text-white hover:bg-orange-600 transition-colors">
                        Connect on LinkedIn
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                    </a>
                `;
                container.appendChild(card);
            });

            if (!state.isMobile && referralLoadMoreBtn) {
                referralLoadMoreBtn.parentElement.style.display = state.allReferrals.length > (state.currentReferralPage * REFERRALS_PER_PAGE_WEB) ? 'block' : 'none';
            } else {
                if (referralLoadMoreBtn) referralLoadMoreBtn.parentElement.style.display = 'none';
            }
        }

        function applyFilters() {
            const searchTerm = state.isMobile ? (document.getElementById('mobile-search-input')?.value || '').toLowerCase() : (document.getElementById('desktop-search-input')?.value || '').toLowerCase();
            const selectedLocation = state.isMobile ? (document.getElementById('filter-location')?.value || '') : (document.getElementById('desktop-location-filter')?.value || '');
            const selectedRole = state.isMobile ? document.querySelector('.mobile-role-pill.active')?.dataset.role || '' : (document.getElementById('desktop-role-filter')?.value || '');

            state.filteredJobs = state.allJobs.filter(job =>
                (searchTerm === '' || job['Job Title'].toLowerCase().includes(searchTerm) || job.Company.toLowerCase().includes(searchTerm)) &&
                (selectedLocation === '' || job.Location === selectedLocation) &&
                (selectedRole === '' || job['Job Title'] === selectedRole)
            );
            state.currentPage = 1;
            render();
        }

        function clearFilters() {
            if (state.isMobile) {
                if (document.getElementById('mobile-search-input')) document.getElementById('mobile-search-input').value = '';
                if (document.getElementById('filter-location')) document.getElementById('filter-location').value = '';
                if (mobileRoleFiltersContainer) mobileRoleFiltersContainer.querySelectorAll('.mobile-role-pill').forEach(p => p.classList.remove('active', 'bg-orange-500'));
            } else {
                if (document.getElementById('desktop-search-input')) document.getElementById('desktop-search-input').value = '';
                if (document.getElementById('desktop-location-filter')) document.getElementById('desktop-location-filter').value = '';
                if (document.getElementById('desktop-role-filter')) document.getElementById('desktop-role-filter').value = '';
            }
            applyFilters();
        }

        function showApplyModal(job) {
            const content = `<div class="text-center"><div class="h-20 w-20 rounded-full bg-gray-800 mx-auto mb-4 overflow-hidden flex items-center justify-center"><img src="${job['Company Logo URL']}" alt="${job.Company} Logo" class="w-full h-full object-cover"></div><h3 class="text-2xl font-bold text-white">${job['Job Title']}</h3><p class="text-gray-400 mb-6">at ${job.Company}</p><p class="bg-gray-800 border border-gray-700 text-orange-400 text-sm rounded-lg p-3 mb-6">✨ **Pro Tip:** Tailor your resume to include keywords from the job description. Good luck!</p><div class="flex flex-col sm:flex-row gap-3"><button id="proceed-btn" class="w-full bg-gradient-to-br from-orange-500 to-orange-600 text-white font-semibold py-3 px-5 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all">Proceed to Application</button><button id="cancel-btn" class="w-full bg-gray-700 text-white font-semibold py-3 px-5 rounded-lg hover:bg-gray-600 transition-colors">Cancel</button></div></div>`;
            modalOverlay.innerHTML = `<div class="modal-content bg-gray-900 border border-gray-800 rounded-2xl shadow-xl w-full max-w-lg mx-auto p-6 md:p-8">${content}</div>`;
            modalOverlay.classList.remove('hidden');
            setTimeout(() => { modalOverlay.classList.add('open', 'opacity-100'); }, 10);
            if (document.getElementById('proceed-btn')) document.getElementById('proceed-btn').addEventListener('click', () => { window.open(job.Link, '_blank'); closeModal(); });
            if (document.getElementById('cancel-btn')) document.getElementById('cancel-btn').addEventListener('click', closeModal);
            const modalImg = modalOverlay.querySelector('img');
            if (modalImg) { modalImg.onerror = () => { modalImg.replaceWith(createDefaultLogo(job.Company)); }; }
        }

        function closeModal() {
            if (modalOverlay) modalOverlay.classList.remove('open', 'opacity-100');
            setTimeout(() => { if (modalOverlay) modalOverlay.classList.add('hidden'); }, 300);
        }

        function openFilterScreen() {
            if (mobileFilterScreen) mobileFilterScreen.style.transform = 'translateX(0)';
        }

        function closeFilterScreen() {
            if (mobileFilterScreen) mobileFilterScreen.style.transform = 'translateX(100%)';
        }

        function populateFilters() {
            const locations = [...new Set(state.allJobs.map(job => job.Location).filter(Boolean))].sort();
            if (desktopLocationFilter) {
                desktopLocationFilter.innerHTML = '<option value="">All Locations</option>';
                locations.forEach(location => desktopLocationFilter.add(new Option(location, location)));
            }
            if (filterLocationSelect) {
                filterLocationSelect.innerHTML = '<option value="">All Locations</option>';
                locations.forEach(location => filterLocationSelect.add(new Option(location, location)));
            }

            const roles = [...new Set(state.allJobs.map(job => job['Job Title']).filter(Boolean))].sort();
            if (desktopRoleFilter) {
                desktopRoleFilter.innerHTML = '<option value="">All Roles</option>';
                roles.forEach(role => desktopRoleFilter.add(new Option(role, role)));
            }
            if (mobileRoleFiltersContainer) {
                mobileRoleFiltersContainer.innerHTML = '';
                roles.forEach(role => {
                    const pill = document.createElement('button');
                    pill.className = 'mobile-role-pill w-full text-left p-3 bg-gray-800 text-gray-300 rounded-lg text-sm';
                    pill.textContent = role;
                    pill.dataset.role = role;
                    mobileRoleFiltersContainer.appendChild(pill);
                });
            }
        }

        async function fetchData() {
            try {
                const [jobsResponse, referralsResponse] = await Promise.all([
                    fetch(JOBS_JSON_URL),
                    fetch(REFERRALS_JSON_URL)
                ]);

                if (!jobsResponse.ok) throw new Error(`HTTP error! status: ${jobsResponse.status} for jobs`);
                if (!referralsResponse.ok) throw new Error(`HTTP error! status: ${referralsResponse.status} for referrals`);

                const jobsData = await jobsResponse.json();
                const referralsData = await referralsResponse.json();

                state.allJobs = (jobsData && Array.isArray(jobsData.jobs)) ? jobsData.jobs : (Array.isArray(jobsData) ? jobsData : []);
                state.allReferrals = (referralsData && Array.isArray(referralsData.referrals)) ? referralsData.referrals : (Array.isArray(referralsData) ? referralsData : []);
                state.filteredJobs = [...state.allJobs];

                if (state.allJobs.length > 0) {
                    populateFilters();
                }
            } catch (error) {
                console.error("Failed to fetch data:", error);
                if (jobGrid) jobGrid.innerHTML = `<p class="text-center text-red-400 col-span-full">Could not load job listings.</p>`;
            } finally {
                if (loadingSpinner) loadingSpinner.style.display = 'none';
                render();
            }
        }
        
        if (loadMoreBtn) loadMoreBtn.addEventListener('click', () => {
            state.currentPage++;
            renderJobs();
        });

        if (referralLoadMoreBtn) referralLoadMoreBtn.addEventListener('click', () => {
            state.currentReferralPage++;
            renderReferrals();
        });
        
        if (desktopSearchInput) desktopSearchInput.addEventListener('input', applyFilters);
        if (desktopLocationFilter) desktopLocationFilter.addEventListener('change', applyFilters);
        if (desktopRoleFilter) desktopRoleFilter.addEventListener('change', applyFilters);
        if (desktopResetFilters) desktopResetFilters.addEventListener('click', clearFilters);
        if (mobileFilterToggle) mobileFilterToggle.addEventListener('click', openFilterScreen);
        if (closeFilterBtn) closeFilterBtn.addEventListener('click', closeFilterScreen);
        if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', () => {
            closeFilterScreen();
            applyFilters();
        });
        if (clearFiltersBtn) clearFiltersBtn.addEventListener('click', clearFilters);
        
        if (filterLocationSelect) filterLocationSelect.addEventListener('change', applyFilters);
        if (mobileRoleFiltersContainer) {
            mobileRoleFiltersContainer.addEventListener('click', (e) => {
                const pill = e.target.closest('.mobile-role-pill');
                if (pill) {
                    const isActive = pill.classList.contains('active');
                    mobileRoleFiltersContainer.querySelectorAll('.mobile-role-pill').forEach(p => p.classList.remove('active', 'bg-orange-500'));
                    if (!isActive) {
                        pill.classList.add('active', 'bg-orange-500');
                        state.filters.role = pill.dataset.role;
                    } else {
                        state.filters.role = '';
                    }
                    applyFilters();
                }
            });
        }
        
        fetchData();
    });
</script>

