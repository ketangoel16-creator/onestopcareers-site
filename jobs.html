Auto-Refresh</span>
          <label for="auto-refresh-toggle" class="inline-flex relative items-center cursor-pointer">
              <input type="checkbox" id="auto-refresh-toggle" class="sr-only peer">
              <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-orange-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
          </label>
      </div>
      <button id="mobile-menu-btn" class="md:hidden text-gray-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
        </svg>
      </button>
    </div>
    <nav id="mobile-menu" class="hidden md:hidden bg-white shadow-lg py-2">
      <a href="index.html" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Home</a>
      <a href="jobs.html" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Find Jobs/referrals</a>
      <a href="resources.html" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Resources</a>
      <a href="mentors.html" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Mentors</a>
       <!-- Auto-refresh Toggle (Mobile) -->
      <div class="px-4 py-3 flex items-center justify-between border-t border-gray-200">
           <span class="text-sm font-medium text-gray-800">Auto-Refresh</span>
           <label for="auto-refresh-toggle-mobile" class="inline-flex relative items-center cursor-pointer">
              <input type="checkbox" id="auto-refresh-toggle-mobile" class="sr-only peer">
              <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-orange-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
          </label>
      </div>
    </nav>
  </header>

  <!-- Job Board -->
  <section id="jobs" class="max-w-6xl mx-auto px-4 py-16">
    <h3 class="text-4xl font-bold text-gray-800 mb-6 border-b-4 border-orange-500 inline-block pb-1">Job Board</h3>
    <p class="text-gray-600 mb-6">Check out recent openings from top companies.</p>
    <div class="flex flex-col md:flex-row items-center justify-between mb-8 space-y-4 md:space-y-0">
      <input type="text" id="job-search" placeholder="Search for jobs..." class="w-full md:w-1/3 p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500" />
      <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
        <select id="company-filter" class="p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
          <option value="">All Companies</option>
        </select>
        <select id="location-filter" class="p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
          <option value="">All Locations</option>
        </select>
        <select id="title-filter" class="p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
          <option value="">All Job Titles</option>
        </select>
      </div>
    </div>
    <div id="job-board-loading" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" style="display: none;">
      <!-- Skeleton loader for jobs -->
      <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200 animate-pulse">
        <div class="h-6 bg-gray-200 rounded w-3/4 mb-2"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2 mb-4"></div>
        <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
        <div class="h-3 bg-gray-200 rounded w-5/6 mb-2"></div>
        <div class="h-3 bg-gray-200 rounded w-4/6 mb-4"></div>
        <div class="h-10 bg-orange-200 rounded-lg"></div>
      </div>
      <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200 animate-pulse hidden md:block">
        <div class="h-6 bg-gray-200 rounded w-3/4 mb-2"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2 mb-4"></div>
        <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
        <div class="h-3 bg-gray-200 rounded w-5/6 mb-2"></div>
        <div class="h-3 bg-gray-200 rounded w-4/6 mb-4"></div>
        <div class="h-10 bg-orange-200 rounded-lg"></div>
      </div>
      <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200 animate-pulse hidden lg:block">
        <div class="h-6 bg-gray-200 rounded w-3/4 mb-2"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2 mb-4"></div>
        <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
        <div class="h-3 bg-gray-200 rounded w-5/6 mb-2"></div>
        <div class="h-3 bg-gray-200 rounded w-4/6 mb-4"></div>
        <div class="h-10 bg-orange-200 rounded-lg"></div>
      </div>
    </div>
    <div id="job-board" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    <div id="pagination-controls" class="flex justify-center items-center space-x-4 mt-8" style="display: none;">
      <button id="prev-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 disabled:opacity-50" disabled>Previous</button>
      <span id="page-info" class="text-gray-600">Page 1 of 1</span>
      <button id="next-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 disabled:opacity-50" disabled>Next</button>
    </div>
  </section>

  <!-- Referral Network Section -->
  <section id="referrals" class="bg-orange-50 py-16">
    <div class="max-w-6xl mx-auto px-4">
        <h3 class="text-4xl font-bold text-gray-800 mb-6 border-b-4 border-orange-500 inline-block pb-1">Referral Network</h3>
        <p class="text-gray-600 mb-8">Connect with professionals willing to give referrals at top companies.</p>
        
        <!-- Search for Referrals -->
        <div class="mb-8">
            <input type="text" id="referral-search" placeholder="Search by name, company, or title..." class="w-full md:w-1/3 p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500" />
        </div>

        <!-- Loading State for Referrals -->
        <div id="referral-loading" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" style="display: none;">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 animate-pulse">
                <div class="flex items-center space-x-4">
                    <div class="h-12 w-12 bg-gray-200 rounded-full"></div>
                    <div class="flex-1 space-y-2">
                        <div class="h-5 bg-gray-200 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                    </div>
                </div>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 animate-pulse hidden md:block">
                <div class="flex items-center space-x-4">
                    <div class="h-12 w-12 bg-gray-200 rounded-full"></div>
                    <div class="flex-1 space-y-2">
                        <div class="h-5 bg-gray-200 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                    </div>
                </div>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 animate-pulse hidden lg:block">
                <div class="flex items-center space-x-4">
                    <div class="h-12 w-12 bg-gray-200 rounded-full"></div>
                    <div class="flex-1 space-y-2">
                        <div class="h-5 bg-gray-200 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                        <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Grid to display referral cards -->
        <div id="referral-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <!-- Pagination for Referrals -->
        <div id="referral-pagination-controls" class="flex justify-center items-center space-x-4 mt-8" style="display: none;">
            <button id="referral-prev-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 disabled:opacity-50" disabled>Previous</button>
            <span id="referral-page-info" class="text-gray-600">Page 1 of 1</span>
            <button id="referral-next-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 disabled:opacity-50" disabled>Next</button>
        </div>
    </div>
  </section>

  <section id="jobs-testimonials" class="bg-gray-800 py-16 text-white">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <h3 class="text-4xl font-bold">Success Stories from Our Job Seekers</h3>
      <p class="text-gray-300 mt-4 max-w-3xl mx-auto">
        Read how our platform helped people find and land their dream jobs.
      </p>
      <div class="grid md:grid-cols-2 gap-8 mt-12">
        <div class="p-8 bg-gray-700 rounded-2xl text-left">
          <p class="text-gray-200 italic">
            "I was struggling to find relevant job openings, but the filters and personalized alerts here made it so easy. I landed a job in just three weeks!"
          </p>
          <p class="mt-4 font-semibold text-orange-500">- Jane Doe, Product Manager</p>
        </div>
        <div class="p-8 bg-gray-700 rounded-2xl text-left">
          <p class="text-gray-200 italic">
            "The combination of the job board and referral tips helped me get my foot in the door at a top company. I wouldn't have found the opportunity otherwise."
          </p>
          <p class="mt-4 font-semibold text-orange-500">- John Smith, Software Engineer</p>
        </div>
      </div>
    </div>
  </section>

  <section class="bg-gray-200 py-16 text-center">
    <div class="max-w-4xl mx-auto px-4">
      <h3 class="text-4xl font-bold text-gray-800">Not Getting Interview Calls?</h3>
      <p class="mt-4 text-gray-600">
        If you're not getting traction on your applications, the problem might not be with the jobs themselves. Get a personalized roadmap from a mentor.
      </p>
      <a href="mentors.html" class="inline-block mt-8 bg-orange-500 text-white text-lg font-semibold px-8 py-4 rounded-xl shadow-lg hover:bg-orange-600 transition-colors">
        Find Your Mentorship →
      </a>
    </div>
  </section>

  <footer class="bg-gray-900 text-white py-6 text-center">
    <p>© 2025 OneStopCareers. All rights reserved.</p>
  </footer>

  <!-- Job Details Modal -->
  <div id="job-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h4 id="modal-title" class="text-2xl font-bold text-orange-700 mb-2"></h4>
      <p id="modal-company-location" class="text-gray-600 font-medium mb-4"></p>
      <p id="modal-description" class="text-gray-700"></p>
      <a id="modal-apply-btn" href="#" target="_blank" class="block mt-6 text-center bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors">Apply Now</a>
    </div>
  </div>

  <!-- Pre-loaded data for instant page load -->
  <script id="preloaded-jobs" type="application/json">
    [
      {
        "Job Title": "Senior Frontend Developer",
        "Company": "Innovate Inc.",
        "Location": "San Francisco, CA",
        "Description": "Join our team to build next-gen web applications using React and TypeScript. 5+ years of experience required.",
        "Link": "#"
      },
      {
        "Job Title": "Product Manager",
        "Company": "Solutions Co.",
        "Location": "New York, NY",
        "Description": "Define product vision, strategy, and roadmap. Work closely with engineering, design, and marketing teams.",
        "Link": "#"
      },
      {
        "Job Title": "Data Scientist",
        "Company": "Future Analytics",
        "Location": "Remote",
        "Description": "Analyze large datasets to extract meaningful insights. Proficiency in Python, SQL, and machine learning frameworks.",
        "Link": "#"
      }
    ]
  </script>
  <script id="preloaded-referrals" type="application/json">
    [
      {
        "Name": "Alex Johnson",
        "Designation": "Engineering Manager",
        "Company name": "Innovate Inc.",
        "LinkedIn ID url": "#"
      },
      {
        "Name": "Brenda Smith",
        "Designation": "Senior Recruiter",
        "Company name": "Solutions Co.",
        "LinkedIn ID url": "#"
      },
      {
        "Name": "Charles Brown",
        "Designation": "Lead Data Scientist",
        "Company name": "Future Analytics",
        "LinkedIn ID url": "#"
      }
    ]
  </script>


  <script>
    // --- DOM Elements ---
    const jobBoard = document.getElementById('job-board');
    const jobBoardLoading = document.getElementById('job-board-loading');
    const jobSearch = document.getElementById('job-search');
    const companyFilter = document.getElementById('company-filter');
    const locationFilter = document.getElementById('location-filter');
    const titleFilter = document.getElementById('title-filter');
    const paginationControls = document.getElementById('pagination-controls');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const pageInfo = document.getElementById('page-info');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const jobModal = document.getElementById('job-modal');
    const modalCloseBtn = jobModal.querySelector('.close-btn');
    const modalTitle = document.getElementById('modal-title');
    const modalCompanyLocation = document.getElementById('modal-company-location');
    const modalDescription = document.getElementById('modal-description');
    const modalApplyBtn = document.getElementById('modal-apply-btn');
    
    // Referral Elements
    const referralGrid = document.getElementById('referral-grid');
    const referralLoading = document.getElementById('referral-loading');
    const referralSearch = document.getElementById('referral-search');
    const referralPaginationControls = document.getElementById('referral-pagination-controls');
    const referralPrevBtn = document.getElementById('referral-prev-btn');
    const referralNextBtn = document.getElementById('referral-next-btn');
    const referralPageInfo = document.getElementById('referral-page-info');
    
    // Auto-Refresh Toggle Elements
    const autoRefreshToggle = document.getElementById('auto-refresh-toggle');
    const autoRefreshToggleMobile = document.getElementById('auto-refresh-toggle-mobile');
    let autoRefreshIntervalId = null;

    // --- State Variables ---
    const jobsPerPage = 6;
    let currentPage = 1;
    let allJobs = [];
    let displayedJobs = [];

    const referralsPerPage = 10;
    let currentReferralPage = 1;
    let allReferrals = [];
    let displayedReferrals = [];

    // --- Config ---
    const CACHE_DURATION = 6 * 60 * 60 * 1000; // 6 hours
    const REFRESH_INTERVAL = 60 * 1000; // 1 minute
    const JOBS_API_URL = 'https://script.google.com/macros/s/AKfycbzxRN194Nx7sio2lGw7yiWBjL63h1eRstGJMCVrrrxzn1pKq2NThKz_GUKtrdQA2Q/exec';
    const REFERRALS_API_URL = 'https://script.google.com/macros/s/AKfycbxkrDnF3ABiwsf2M8dD7hKtCGwQ4XSRdQebmJOqL8jsSpdQtCwrb6xH7KeHxKUoK0IB/exec';

    // --- Mobile Menu Toggle ---
    mobileMenuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // --- Modal Logic ---
    const openJobModal = (job) => {
      modalTitle.textContent = job['Job Title'];
      modalCompanyLocation.textContent = `${job['Company']} - ${job['Location']}`;
      modalDescription.textContent = job['Description'];
      modalApplyBtn.href = job['Link'];
      jobModal.style.display = 'block';
    };

    modalCloseBtn.addEventListener('click', () => {
      jobModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target === jobModal) {
        jobModal.style.display = 'none';
      }
    });

    // --- Job Rendering and Filtering ---
    const renderJobs = (jobs, page = 1) => {
      jobBoard.innerHTML = ''; // Clear previous results
      const start = (page - 1) * jobsPerPage;
      const end = start + jobsPerPage;
      const paginatedJobs = jobs.slice(start, end);

      if (paginatedJobs.length === 0) {
        jobBoard.innerHTML = '<p class="text-gray-500 text-center col-span-3">No jobs found matching your criteria.</p>';
      } else {
        paginatedJobs.forEach(job => {
          const jobCard = document.createElement('div');
          jobCard.className = 'job-card cursor-pointer bg-white p-5 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-shadow';
          jobCard.innerHTML = `
            <h4 class="text-xl font-bold text-orange-700"></h4>
            <p class="text-gray-600 font-medium"></p>
            <p class="text-gray-500 text-sm mt-2 line-clamp-2"></p>
            <a href="#" target="_blank" class="block mt-4 text-center bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600 transition-colors">Apply Now</a>
          `;
          jobCard.querySelector('h4').textContent = job['Job Title'] || 'N/A';
          jobCard.querySelector('.text-gray-600').textContent = `${job['Company'] || 'N/A'} - ${job['Location'] || 'N/A'}`;
          jobCard.querySelector('.line-clamp-2').textContent = job['Description'] || '';
          jobCard.querySelector('a').href = job['Link'] || '#';
          
          jobCard.addEventListener('click', (e) => {
            if (e.target.tagName.toLowerCase() !== 'a') {
              openJobModal(job);
            }
          });
          jobBoard.appendChild(jobCard);
        });
      }

      const totalPages = Math.ceil(jobs.length / jobsPerPage);
      pageInfo.textContent = `Page ${page} of ${totalPages || 1}`;
      prevBtn.disabled = page === 1;
      nextBtn.disabled = page === totalPages || totalPages === 0;
      paginationControls.style.display = jobs.length > jobsPerPage ? 'flex' : 'none';
    };

    const populateFilters = (jobs) => {
      const getUniqueSortedValues = (key) => [...new Set(jobs.map(job => job[key]).filter(Boolean))].sort();
      const companies = getUniqueSortedValues('Company');
      const locations = getUniqueSortedValues('Location');
      const titles = getUniqueSortedValues('Job Title');
      
      const populateSelect = (selectElement, options) => {
          const currentVal = selectElement.value;
          selectElement.innerHTML = `<option value="">All ${selectElement.id.split('-')[0].charAt(0).toUpperCase() + selectElement.id.split('-')[0].slice(1)}</option>`;
          options.forEach(option => {
              selectElement.innerHTML += `<option value="${option}">${option}</option>`;
          });
          selectElement.value = currentVal;
      };

      populateSelect(companyFilter, companies);
      populateSelect(locationFilter, locations);
      populateSelect(titleFilter, titles);
    };

    const filterAndRenderJobs = () => {
      const searchTerm = jobSearch.value.toLowerCase();
      const company = companyFilter.value;
      const location = locationFilter.value;
      const title = titleFilter.value;

      displayedJobs = allJobs.filter(job => 
        ( (job['Job Title'] || '').toLowerCase().includes(searchTerm) ||
          (job['Company'] || '').toLowerCase().includes(searchTerm) ||
          (job['Location'] || '').toLowerCase().includes(searchTerm) ) &&
        (company === '' || job['Company'] === company) &&
        (location === '' || job['Location'] === location) &&
        (title === '' || job['Job Title'] === title)
      );
      currentPage = 1;
      renderJobs(displayedJobs, currentPage);
    };

    // --- Referral Rendering and Filtering ---
    const renderReferrals = (referrals, page = 1) => {
        referralGrid.innerHTML = '';
        const start = (page - 1) * referralsPerPage;
        const end = start + referralsPerPage;
        const paginatedReferrals = referrals.slice(start, end);

        if (paginatedReferrals.length > 0) {
            paginatedReferrals.forEach(prof => {
                const card = document.createElement('a');
                card.href = prof['LinkedIn ID url'] || '#';
                card.target = '_blank';
                card.className = 'block p-6 bg-white rounded-xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300';
                card.innerHTML = `
                  <div class="flex items-start space-x-4">
                    <img src="https://cdn-icons-png.flaticon.com/512/174/174857.png" class="h-10 w-10 flex-shrink-0" alt="LinkedIn Icon" />
                    <div>
                      <h4 class="text-lg font-semibold text-gray-800"></h4>
                      <p class="text-gray-600"></p>
                      <p class="text-sm text-gray-500 font-medium"></p>
                    </div>
                  </div>
                `;
                card.querySelector('h4').textContent = prof['Name'] || 'N/A';
                card.querySelector('.text-gray-600').textContent = prof['Designation'] || 'N/A';
                card.querySelector('.text-sm').textContent = prof['Company name'] || 'N/A';
                referralGrid.appendChild(card);
            });
        } else {
            referralGrid.innerHTML = '<p class="text-gray-500 text-center col-span-3">No professionals found matching your criteria.</p>';
        }

        const totalPages = Math.ceil(referrals.length / referralsPerPage);
        referralPageInfo.textContent = `Page ${page} of ${totalPages || 1}`;
        referralPrevBtn.disabled = page === 1;
        referralNextBtn.disabled = page === totalPages || totalPages === 0;
        referralPaginationControls.style.display = referrals.length > referralsPerPage ? 'flex' : 'none';
    };
    
    const filterAndRenderReferrals = () => {
        const searchTerm = referralSearch.value.toLowerCase();
        displayedReferrals = allReferrals.filter(prof => 
            (prof['Name'] || '').toLowerCase().includes(searchTerm) ||
            (prof['Designation'] || '').toLowerCase().includes(searchTerm) ||
            (prof['Company name'] || '').toLowerCase().includes(searchTerm)
        );
        currentReferralPage = 1;
        renderReferrals(displayedReferrals, currentReferralPage);
    };

    // --- Data Fetching with Caching ---
    const fetchAndCacheData = async (options) => {
        const { url, cacheKey, loadingElement, gridElement, setupFunction, forceRefresh = false, showLoading = false } = options;

        if (!forceRefresh) {
            const cachedItem = localStorage.getItem(cacheKey);
            if (cachedItem) {
                const { timestamp, data } = JSON.parse(cachedItem);
                if (new Date().getTime() - timestamp < CACHE_DURATION) {
                    console.log(`Loading ${cacheKey} from cache.`);
                    setupFunction(data);
                    return;
                }
            }
        }

        if (showLoading) {
            loadingElement.style.display = 'grid';
            gridElement.style.display = 'none';
        }
        
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            
            localStorage.setItem(cacheKey, JSON.stringify({ timestamp: new Date().getTime(), data: data }));
            setupFunction(data);
        } catch (error) {
            console.error(`Failed to fetch data from ${url}:`, error);
            gridElement.innerHTML = `<p class="text-red-500 text-center col-span-3">Failed to load data. Please try again later.</p>`;
        } finally {
            if (showLoading) {
                loadingElement.style.display = 'none';
                gridElement.style.display = 'grid';
            }
        }
    };

    const setupJobs = (data) => {
        allJobs = data;
        populateFilters(allJobs);
        filterAndRenderJobs();
    };

    const setupReferrals = (data) => {
        allReferrals = data;
        filterAndRenderReferrals();
    };
    
    // --- Auto-Refresh Logic ---
    const handleToggleChange = (isChecked) => {
        autoRefreshToggle.checked = isChecked;
        autoRefreshToggleMobile.checked = isChecked;

        if (isChecked) {
            console.log('Auto-refresh enabled.');
            const options = { forceRefresh: true, showLoading: true };
            fetchAndCacheData({ ...options, url: JOBS_API_URL, cacheKey: 'jobs_cache', loadingElement: jobBoardLoading, gridElement: jobBoard, setupFunction: setupJobs });
            fetchAndCacheData({ ...options, url: REFERRALS_API_URL, cacheKey: 'referrals_cache', loadingElement: referralLoading, gridElement: referralGrid, setupFunction: setupReferrals });

            autoRefreshIntervalId = setInterval(() => {
                console.log('Auto-refreshing data...');
                fetchAndCacheData({ ...options, url: JOBS_API_URL, cacheKey: 'jobs_cache', loadingElement: jobBoardLoading, gridElement: jobBoard, setupFunction: setupJobs });
                fetchAndCacheData({ ...options, url: REFERRALS_API_URL, cacheKey: 'referrals_cache', loadingElement: referralLoading, gridElement: referralGrid, setupFunction: setupReferrals });
            }, REFRESH_INTERVAL);
        } else {
            console.log('Auto-refresh disabled.');
            if (autoRefreshIntervalId) {
                clearInterval(autoRefreshIntervalId);
                autoRefreshIntervalId = null;
            }
        }
    };


    // --- Initial Load & Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Render pre-loaded data immediately for instant UI
        try {
            const preloadedJobs = JSON.parse(document.getElementById('preloaded-jobs').textContent);
            setupJobs(preloadedJobs);
        } catch (e) {
            console.error("Could not parse preloaded jobs data.", e);
            jobBoard.innerHTML = `<p class="text-red-500 text-center col-span-3">Could not load initial job data.</p>`;
        }

        try {
            const preloadedReferrals = JSON.parse(document.getElementById('preloaded-referrals').textContent);
            setupReferrals(preloadedReferrals);
        } catch (e) {
            console.error("Could not parse preloaded referrals data.", e);
            referralGrid.innerHTML = `<p class="text-red-500 text-center col-span-3">Could not load initial referral data.</p>`;
        }

        // 2. Fetch fresh data in the background
        setTimeout(() => {
            fetchAndCacheData({ url: JOBS_API_URL, cacheKey: 'jobs_cache', setupFunction: setupJobs });
            fetchAndCacheData({ url: REFERRALS_API_URL, cacheKey: 'referrals_cache', setupFunction: setupReferrals });
        }, 500);


        // Job listeners
        jobSearch.addEventListener('input', filterAndRenderJobs);
        companyFilter.addEventListener('change', filterAndRenderJobs);
        locationFilter.addEventListener('change', filterAndRenderJobs);
        titleFilter.addEventListener('change', filterAndRenderJobs);
        
        prevBtn.addEventListener('click', () => {  
          if (currentPage > 1) {  
            currentPage--;  
            renderJobs(displayedJobs, currentPage);  
          }  
        });
        nextBtn.addEventListener('click', () => {  
          const totalPages = Math.ceil(displayedJobs.length / jobsPerPage);  
          if (currentPage < totalPages) {  
            currentPage++;  
            renderJobs(displayedJobs, currentPage);  
          }  
        });

        // Referral listeners
        referralSearch.addEventListener('input', filterAndRenderReferrals);

        referralPrevBtn.addEventListener('click', () => {
            if (currentReferralPage > 1) {
                currentReferralPage--;
                renderReferrals(displayedReferrals, currentReferralPage);
            }
        });
        referralNextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(displayedReferrals.length / referralsPerPage);
            if (currentReferralPage < totalPages) {
                currentReferralPage++;
                renderReferrals(displayedReferrals, currentReferralPage);
            }
        });

        // Toggle listeners
        autoRefreshToggle.addEventListener('change', (e) => handleToggleChange(e.target.checked));
        autoRefreshToggleMobile.addEventListener('change', (e) => handleToggleChange(e.target.checked));
    });
  </script>

</body>
</html>
```
